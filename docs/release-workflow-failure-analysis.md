# Release Workflow Failure Analysis

## Issue

The Release workflow failed on run #21304489526 (tag v0.11.2) at the "Start MCP gateway" step.

**Workflow**: `release.lock.yml` (generated by GitHub agentic workflows system)
**Failed Job**: `agent` (step 16: "Start MCP gateway")  
**Run URL**: https://github.com/githubnext/gh-aw-firewall/actions/runs/21304489526

## Root Cause

The MCP Gateway container (from `githubnext/gh-aw-mcpg:v0.0.59`) is trying to bind to port 80, which requires root/elevated privileges on Linux systems. The failure manifests as:

```
[INFO] Gateway will listen on 0.0.0.0:80
...
Port 80 does not appear to be listening
##[error]Process completed with exit code 1.
```

### Technical Details

1. The gateway starts with `docker run --network host`
2. With `--network host`, the container shares the host's network namespace
3. Binding to port 80 (a privileged port < 1024) requires:
   - Container running as root, OR
   - Container with `NET_BIND_SERVICE` capability
4. The current container configuration lacks these privileges
5. Health check at `http://localhost:80/health` fails after 120 retries (2 minutes)
6. curl exit code 7: "Failed to connect to host"

### Evidence from Logs

```
2026/01/23 23:25:37 [INFO] Gateway will listen on 0.0.0.0:80
2026/01/23 23:25:37 Gateway started with PID: 3678
2026/01/23 23:25:37 Gateway process confirmed running (PID: 3678)
...
2026/01/23 23:27:42 Curl exit code: 7
2026/01/23 23:27:42 Health endpoint HTTP code: 000
2026/01/23 23:27:42 ERROR: Gateway failed to become ready
```

## Impact

- **Scope**: Affects all agentic workflow executions that require the MCP Gateway
- **Severity**: **Critical** - Blocks all automated releases
- **Affected Component**: External dependency (`githubnext/gh-aw/actions/setup@v0.37.3`)

## Solution Options

### Option 1: Use Non-Privileged Port (Recommended)

The MCP Gateway should be configured to use a non-privileged port (e.g., 8080 instead of 80).

**Action Required**: This needs to be fixed in the `githubnext/gh-aw` repository, specifically:
- MCP Gateway container default port configuration
- Or: Add configuration option to specify custom port

### Option 2: Grant NET_BIND_SERVICE Capability

Add the `NET_BIND_SERVICE` capability to the gateway container:

```yaml
docker run --cap-add=NET_BIND_SERVICE --network host ...
```

**Note**: This requires changes to the `githubnext/gh-aw/actions/setup` action.

### Option 3: Run Gateway as Root

Run the gateway container as root user (not recommended for security reasons):

```yaml
docker run --user root --network host ...
```

## Workaround

Until the upstream issue is fixed, the Release workflow cannot complete successfully. Manual release process may be required:

1. Create release manually via GitHub UI
2. Build and push Docker images manually
3. Create and upload release artifacts manually

Alternatively, if there's a configuration option in the agentic workflows system to specify a custom gateway port, that should be used.

## Recommended Actions

1. **Report to githubnext/gh-aw**: File an issue in the `githubnext/gh-aw` repository about the MCP Gateway port binding failure
2. **Check for Configuration**: Review if there's already a way to configure a custom port for the MCP Gateway
3. **Update actions-lock.json**: When a fix is released, update the version in `.github/aw/actions-lock.json`

## Related Files

- `.github/aw/actions-lock.json` - Contains locked version of `githubnext/gh-aw/actions/setup@v0.37.3`
- `.github/workflows/release.yml` - Original release workflow (non-agentic)
- Agentic workflow source is in `githubnext/gh-aw` repository (not in this repo)

## Status

- [ ] Issue reported to githubnext/gh-aw
- [ ] Configuration option identified
- [ ] Fix applied and verified
- [ ] Release workflow succeeds

Last Updated: 2026-01-27
